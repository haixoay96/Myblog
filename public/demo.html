<!DOCTYPE html>
<html lang="en" xmlns:sau="http://www.w3.org/1999/xhtml">
<head>
    <title>Blog developer !</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/node_modules/bootstrap/dist/css/bootstrap.min.css">
    <link href="http://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
    <link rel="shortcut icon" type="image/PNG" href="/public/images/icon.png"/>
    <script src="/node_modules/jquery/dist/jquery.min.js"></script>
    <script src="/node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
    <style>
        body {
            font: 20px Montserrat, sans-serif;
            line-height: 1.8;
            color: #f5f6f7;
        }

        p {
            font-size: 16px;
        }

        .margin {
            margin-bottom: 45px;
        }

        .bg-1 {
            background-color: #1abc9c; /* Green */
            color: #ffffff;
        }

        .bg-2 {
            background-color: #474e5d; /* Dark Blue */
            color: #ffffff;
        }

        .bg-3 {
            background-color: #ffffff; /* White */
            color: #555555;
        }

        .bg-4 {
            background-color: #2f2f2f; /* Black Gray */
            color: #fff;
        }

        .container-fluid {
            padding-top: 70px;
            padding-bottom: 70px;
        }

        .navbar {
            padding-top: 15px;
            padding-bottom: 15px;
            border: 0;
            border-radius: 0;
            margin-bottom: 0;
            font-size: 12px;
            letter-spacing: 5px;
        }

        .navbar-nav li a:hover {
            color: #1abc9c !important;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-default">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Home</a>
        </div>
        <div class="collapse navbar-collapse" id="myNavbar">
            <ul class="nav navbar-nav navbar-right">
                <li><a href="#">Who?</a></li>
                <li><a href="#">What?</a></li>
                <li><a href="#">How?</a></li>
                <li><a href="#">Book</a></li>
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown">Programming<span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="/programming/1">Java</a></li>
                        <li><a href="/programming/2">Android</a></li>
                        <li><a href="/programming/3">Nodejs</a></li>
                        <li><a href="/programming/4">C/C++</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>
<div class="container">
    <div class="jumbotron">
        <p style="color: #2f2f2f">
            Hi!, chào các bạn , bài viết trước mình có hướng dẫn các bạn cách truyền file từ nodejs về client ( cụ thể là 1 file html).<br>
            Hôm nay mình sẽ hướng dẫn các bạn trả về 1 file trong đó có chứa ảnh , file js ...vvv. <br>
            Trước hết chúng ta cần phân tích 1 file html chứa ảnh và file js<br>
            Giả mình có 1 file html, trong đó có chứa 1 bức ảnh , 1 file javascript, thì để hiện thị được đầy đủ dữ liệu của html đó lên trình duyệt thì chúng ta cần phải gửi đến server 3 request:<br>
            1 là request yêu cầu server trả về file html. <br>
            2 là request yêu cầu server trả về file ảnh. <br>
            3 là request yêu cầu server trả về file javascript. <br>
            Tốt nhất là chúng ta nên đi vào ví dụ cụ thể sau. <br>
            Giả sử mình có 1 file index.html sau:<br>
        </p>
        <pre style='color:#d1d1d1;background:#000000;'><span style='color:#008073; '>&lt;!DOCTYPE html></span>
<span style='color:#ff8906; '>&lt;</span><span style='color:#e66170; font-weight:bold; '>html</span> lang<span style='color:#d2cd86; '>=</span><span style='color:#00c4c4; '>"en"</span><span style='color:#ff8906; '>></span>
<span style='color:#ff8906; '>&lt;</span><span style='color:#e66170; font-weight:bold; '>head</span><span style='color:#ff8906; '>></span>
	<span style='color:#ff8906; '>&lt;</span><span style='color:#e66170; font-weight:bold; '>meta</span> charset<span style='color:#d2cd86; '>=</span><span style='color:#00c4c4; '>"UTF-8"</span><span style='color:#ff8906; '>></span>
	<span style='color:#ff8906; '>&lt;</span><span style='color:#e66170; font-weight:bold; '>title</span><span style='color:#ff8906; '>></span>Hello world<span style='color:#ff8906; '>&lt;/</span><span style='color:#e66170; font-weight:bold; '>title</span><span style='color:#ff8906; '>></span>
	<span style='color:#ff8906; '>&lt;</span><span style='color:#e66170; font-weight:bold; '>script</span> src<span style='color:#d2cd86; '>=</span><span style='color:#00c4c4; '>'/main.js'</span><span style='color:#ff8906; '>></span><span style='color:#ff8906; '>&lt;/</span><span style='color:#e66170; font-weight:bold; '>script</span><span style='color:#ff8906; '>></span>
<span style='color:#ff8906; '>&lt;/</span><span style='color:#e66170; font-weight:bold; '>head</span><span style='color:#ff8906; '>></span>
<span style='color:#ff8906; '>&lt;</span><span style='color:#e66170; font-weight:bold; '>body</span><span style='color:#ff8906; '>></span>
<span style='color:#ff8906; '>&lt;</span><span style='color:#e66170; font-weight:bold; '>img</span> src<span style='color:#d2cd86; '>=</span><span style='color:#00c4c4; '>"/developer.jpg"</span><span style='color:#ff8906; '>></span>

<span style='color:#ff8906; '>&lt;/</span><span style='color:#e66170; font-weight:bold; '>body</span><span style='color:#ff8906; '>></span>
<span style='color:#ff8906; '>&lt;/</span><span style='color:#e66170; font-weight:bold; '>html</span><span style='color:#ff8906; '>></span>
</pre>
        <p style="color: #2f2f2f">
            Bây giờ mình cần hiện thị file này lên trình duyệt .<br>
            Trong file html có chứa 1 file ảnh và 1 file javascript. <br>
            Chúng ta cùng theo dõi đoạn code server sau: <br>
        </p>
        <pre style='color:#d1d1d1;background:#000000;'><span style='color:#e66170; font-weight:bold; '>var</span> http <span style='color:#d2cd86; '>=</span> require<span style='color:#d2cd86; '>(</span><span style='color:#02d045; '>'</span><span style='color:#00c4c4; '>http</span><span style='color:#02d045; '>'</span><span style='color:#d2cd86; '>)</span><span style='color:#b060b0; '>;</span>
<span style='color:#e66170; font-weight:bold; '>var</span> fs <span style='color:#d2cd86; '>=</span> require<span style='color:#d2cd86; '>(</span><span style='color:#02d045; '>'</span><span style='color:#00c4c4; '>fs</span><span style='color:#02d045; '>'</span><span style='color:#d2cd86; '>)</span><span style='color:#b060b0; '>;</span>
<span style='color:#e66170; font-weight:bold; '>var</span> path <span style='color:#d2cd86; '>=</span> require<span style='color:#d2cd86; '>(</span><span style='color:#02d045; '>'</span><span style='color:#00c4c4; '>path</span><span style='color:#02d045; '>'</span><span style='color:#d2cd86; '>)</span><span style='color:#b060b0; '>;</span>

<span style='color:#e66170; font-weight:bold; '>var</span> mineLookup <span style='color:#d2cd86; '>=</span> <span style='color:#b060b0; '>{</span>
	<span style='color:#02d045; '>'</span><span style='color:#00c4c4; '>.js</span><span style='color:#02d045; '>'</span><span style='color:#b060b0; '>:</span><span style='color:#02d045; '>'</span><span style='color:#00c4c4; '>application/javascript</span><span style='color:#02d045; '>'</span><span style='color:#d2cd86; '>,</span>
	<span style='color:#02d045; '>'</span><span style='color:#00c4c4; '>.html</span><span style='color:#02d045; '>'</span><span style='color:#b060b0; '>:</span><span style='color:#02d045; '>'</span><span style='color:#00c4c4; '>text/html</span><span style='color:#02d045; '>'</span><span style='color:#d2cd86; '>,</span>
	<span style='color:#02d045; '>'</span><span style='color:#00c4c4; '>.jpg</span><span style='color:#02d045; '>'</span><span style='color:#b060b0; '>:</span><span style='color:#02d045; '>'</span><span style='color:#00c4c4; '>image/jpeg</span><span style='color:#02d045; '>'</span><span style='color:#d2cd86; '>,</span>
	<span style='color:#02d045; '>'</span><span style='color:#00c4c4; '>.png</span><span style='color:#02d045; '>'</span><span style='color:#b060b0; '>:</span><span style='color:#02d045; '>'</span><span style='color:#00c4c4; '>image/png</span><span style='color:#02d045; '>'</span><span style='color:#d2cd86; '>,</span>
	<span style='color:#02d045; '>'</span><span style='color:#00c4c4; '>.css</span><span style='color:#02d045; '>'</span><span style='color:#b060b0; '>:</span> <span style='color:#02d045; '>'</span><span style='color:#00c4c4; '>text/css</span><span style='color:#02d045; '>'</span>
<span style='color:#b060b0; '>}</span><span style='color:#b060b0; '>;</span>
http<span style='color:#d2cd86; '>.</span>createServer<span style='color:#d2cd86; '>(</span><span style='color:#e66170; font-weight:bold; '>function</span> <span style='color:#d2cd86; '>(</span>req<span style='color:#d2cd86; '>,</span>res<span style='color:#d2cd86; '>)</span> <span style='color:#b060b0; '>{</span>
	<span style='color:#e66170; font-weight:bold; '>if</span><span style='color:#d2cd86; '>(</span>req<span style='color:#d2cd86; '>.</span>method <span style='color:#d2cd86; '>===</span> <span style='color:#02d045; '>'</span><span style='color:#00c4c4; '>GET</span><span style='color:#02d045; '>'</span><span style='color:#d2cd86; '>)</span><span style='color:#b060b0; '>{</span>
		<span style='color:#e66170; font-weight:bold; '>var</span> fileurl<span style='color:#b060b0; '>;</span>
		<span style='color:#e66170; font-weight:bold; '>if</span><span style='color:#d2cd86; '>(</span>req<span style='color:#d2cd86; '>.</span>url <span style='color:#d2cd86; '>===</span> <span style='color:#02d045; '>'</span><span style='color:#00c4c4; '>/</span><span style='color:#02d045; '>'</span><span style='color:#d2cd86; '>)</span><span style='color:#b060b0; '>{</span>
			fileurl <span style='color:#d2cd86; '>=</span> <span style='color:#02d045; '>'</span><span style='color:#00c4c4; '>/index.html</span><span style='color:#02d045; '>'</span><span style='color:#b060b0; '>;</span>
		<span style='color:#b060b0; '>}</span>
		<span style='color:#e66170; font-weight:bold; '>else</span><span style='color:#b060b0; '>{</span>
			fileurl <span style='color:#d2cd86; '>=</span> req<span style='color:#d2cd86; '>.</span>url<span style='color:#b060b0; '>;</span>
		<span style='color:#b060b0; '>}</span>
		<span style='color:#e66170; font-weight:bold; '>var</span> filepath <span style='color:#d2cd86; '>=</span> <span style='color:#02d045; '>'</span><span style='color:#00c4c4; '>./public</span><span style='color:#02d045; '>'</span><span style='color:#d2cd86; '>+</span>fileurl<span style='color:#b060b0; '>;</span>

		<span style='color:#e66170; font-weight:bold; '>var</span> fileExt <span style='color:#d2cd86; '>=</span> path<span style='color:#d2cd86; '>.</span>extname<span style='color:#d2cd86; '>(</span>filepath<span style='color:#d2cd86; '>)</span><span style='color:#b060b0; '>;</span>
		<span style='color:#e66170; font-weight:bold; '>var</span> mimeType <span style='color:#d2cd86; '>=</span> mineLookup<span style='color:#d2cd86; '>[</span>fileExt<span style='color:#d2cd86; '>]</span><span style='color:#b060b0; '>;</span>

		fs<span style='color:#d2cd86; '>.</span>exists<span style='color:#d2cd86; '>(</span>filepath<span style='color:#d2cd86; '>,</span> <span style='color:#e66170; font-weight:bold; '>function</span> <span style='color:#d2cd86; '>(</span>exists<span style='color:#d2cd86; '>)</span> <span style='color:#b060b0; '>{</span>
			<span style='color:#e66170; font-weight:bold; '>if</span> <span style='color:#d2cd86; '>(</span>exists<span style='color:#d2cd86; '>)</span> <span style='color:#b060b0; '>{</span>
				res<span style='color:#d2cd86; '>.</span>writeHead<span style='color:#d2cd86; '>(</span><span style='color:#008c00; '>200</span><span style='color:#d2cd86; '>,</span> <span style='color:#b060b0; '>{</span><span style='color:#02d045; '>'</span><span style='color:#00c4c4; '>content-type</span><span style='color:#02d045; '>'</span><span style='color:#b060b0; '>:</span> mimeType<span style='color:#b060b0; '>}</span><span style='color:#d2cd86; '>)</span><span style='color:#b060b0; '>;</span>
				fs<span style='color:#d2cd86; '>.</span>createReadStream<span style='color:#d2cd86; '>(</span>filepath<span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>.</span>pipe<span style='color:#d2cd86; '>(</span>res<span style='color:#d2cd86; '>)</span><span style='color:#b060b0; '>;</span>
				<span style='color:#e66170; font-weight:bold; '>return</span><span style='color:#b060b0; '>;</span>
			<span style='color:#b060b0; '>}</span>
			res<span style='color:#d2cd86; '>.</span>end<span style='color:#d2cd86; '>(</span><span style='color:#d2cd86; '>)</span><span style='color:#b060b0; '>;</span>
		<span style='color:#b060b0; '>}</span><span style='color:#d2cd86; '>)</span><span style='color:#b060b0; '>;</span>
	<span style='color:#b060b0; '>}</span>
<span style='color:#b060b0; '>}</span><span style='color:#d2cd86; '>)</span><span style='color:#d2cd86; '>.</span>listen<span style='color:#d2cd86; '>(</span><span style='color:#008c00; '>3000</span><span style='color:#d2cd86; '>)</span><span style='color:#b060b0; '>;</span>
</pre>
        <p style="color:#2f2f2f">
            3 dòng này dùng để import thư viện.<br>
            var http = require('http'); // dùng để tạo server http. <br>
            var fs = require('fs');// dùng để đọc và truyền file <br>
            var path = require('path');// dùng để phân tích file<br>
            var mineLookup = { <br>
                '.js':'application/javascript',<br>
                '.html':'text/html',<br>
                '.jpg':'image/jpeg',<br>
                '.png':'image/png',<br>
                '.css': 'text/css'<br>
            };<br>
            Đối tượng mineLookup dùng để ánh xạ từ đuổi của file sang kiểu file dùng để set content-type thông báo cho client biết là kiểu dữ liệu trả về là gì.<br>
            Hàm createSever thì chúng ta biết rồi, mình sẽ giải thích hàm callback được truyền vào. <br>
            Trước hết thì chúng ta để toàn bộ file ảnh , file js , file html vào thư mục public nhé ( thư mục public ở trong thư mục chứa project). <br>
            Nào chúng ta phân tích tiếp nhé! <br>
            req.method đoạn code này giúp chúng là lấy được kiểu phương thức mà client gửi lên, có  nhưng kiểu phương thức hay dùng đó là get , post , update , delete .<br>
            req.url giúp chúng ta lấy được url được gửi lên ví dụ : http://127.0.1.1:3000/chanthenhi thì /chanthenhi chính là url .<br>
            Nếu chúng ta gõ vào http://127.0.1.1:3000 thì url sẽ là / và khi đó chúng ta sẽ trả về cho trình duyệt file html. <br>
            Còn nếu là http://127.0.1.1:3000/developer.jpg thì ta trả về file developer.jpg tương tự cho file js và những file khác nếu có. <br>
            var filepath = './public'+fileurl; // dùng để lấy đường dẫn của file tương ứng với url được gửi lên ( vì ta để chúng trong thư mục public nên phải có chữ public ở trước @@) .<br>
            var fileExt = path.extname(filepath);// dùng để lấy đuổi của file ví dụ index.html thì sẽ lấy được đuôi là .html rồi dùng để ánh xạ sang text/html trong đối tượng mimeLookup đó. <br>
            Rồi cuối cùng fs.exists là check xem nếu file đó có tồn tại không , nếu có thì ta trả về cho client còn không thì ta chẳng trả về gì @@ <br>
            Rồi chạy thử server rồi vào trình duyệt gõ http://127.0.0.1:3000 nó sẽ hiện thị nội dung như chúng ta mong đợi bao gồm có cả ảnh ... <br>
            <br>
            Vâng như vậy là mình vừa hướng dẫn các bạn các hiện thị 1 file html mà nó có chứa ảnh , js , css ...vvv <br>
            Đến đây nhiều bạn làm về php rồi sẽ thấy ủa sao nó lằng nhăng vậy php thì chẳng cần làm gì cũng hiện thi được .<br>
            Thì xin thưa với các bạn là php được hỗ trợ sẵn server phục vụ static file rồi nên các bạn không cần phải làm gì, còn nodejs thì các bạn phải tự viết hết. Nhưng trong nodejs cũng có rất nhiều framework hỗ trợ sẵn cho chúng ta static file ví dụ như express và ở bài sau mình sẽ hướng dẫn các bạn về express. <br>
            Cảm ơn các bạn đã theo dõi bài viết !!
        </p>
    </div>
</div>
</body>
</html>